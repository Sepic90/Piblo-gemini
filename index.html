<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Piblo - Car Service Tracker</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <!-- Login View -->
    <div id="login-container">
        <div class="login-box">
            <h1>Piblo</h1>
            <p>Car Service Tracker</p>
            <form id="login-form">
                <div class="input-group">
                    <label for="email">Email</label>
                    <input type="email" id="email" required>
                </div>
                <div class="input-group">
                    <label for="password">Password</label>
                    <input type="password" id="password" required>
                </div>
                <button type="submit">Sign In</button>
                <p id="login-error"></p>
            </form>
        </div>
    </div>

    <!-- Main App View (hidden by default) -->
    <div id="app-container" class="hidden">
        <nav class="sidebar">
            <div class="sidebar-header">
				<img src="logo.png" alt="Piblo" class="sidebar-logo">
				<h2>Piblo</h2>
			</div>
            <ul>
                <li><a href="#" class="nav-link" data-page="new-entry">New Entry</a></li>
                <li class="has-submenu">
                    <a href="#" class="nav-link-parent" id="history-parent">Entry History</a>
                    <ul class="submenu" id="history-submenu">
                        <!-- Cars will be dynamically loaded here -->
                    </ul>
                </li>
                <li><a href="#" class="nav-link" data-page="manage-cars">Manage Cars</a></li>
                <li><a href="#" id="sign-out-btn">Sign Out</a></li>
            </ul>
        </nav>

        <main class="main-content">
            <header class="main-header">
                <button id="menu-toggle">&#9776;</button>
                <h1 id="page-title">Welcome</h1>
            </header>
            
            <div class="content-area">
                <!-- New Entry Page -->
                <div id="new-entry" class="page-content">
					<form id="service-entry-form" class="piblo-form">
						
						<div class="form-grid-compact">
							<div class="input-group">
								<label for="entry-car">Select Car</label>
								<select id="entry-car" required>
									<option value="">-- Select a Car --</option>
								</select>
							</div>
							
							<div class="input-group">
								<label for="entry-date">Date</label>
								<input type="date" id="entry-date" required>
							</div>

							<div class="input-group">
								<label for="entry-odometer">Odometer Reading</label>
								<input type="number" id="entry-odometer" placeholder="e.g., 150000" required>
							</div>

							<div class="input-group checkbox-group">
								<label for="entry-oil-changed">
									<input type="checkbox" id="entry-oil-changed" class="piblo-checkbox">
									<span>Oil Changed</span>
								</label>
							</div>
						</div>
						
						<div class="input-group">
							<label for="entry-task">Task / Title</label>
							<input type="text" id="entry-task" placeholder="e.g., Annual Service" required>
						</div>

						<div class="input-group">
							<label for="entry-description">Description</label>
							<textarea id="entry-description" rows="4" placeholder="Describe the work done..."></textarea>
						</div>

						<div class="parts-section">
							<label>Parts/Consumables Used</label>
							<div id="parts-container">
								<!-- One default part row will be added by JavaScript -->
							</div>
							<button type="button" id="add-part-btn" class="btn-secondary-small">+ Add Another Part</button>
						</div>
						
						<div class="input-group">
							<label for="entry-photos">Add Photo(s)</label>
							<input type="file" id="entry-photos" accept="image/*" multiple>
						</div>

						<div id="photo-preview-container"></div>
						
						<div id="upload-status-container" class="hidden"></div>
						
						<div class="form-actions">
							<button type="submit" class="btn-primary" id="save-entry-btn">Save Entry</button>
						</div>

					</form>
				</div>

                <!-- Entry History Page -->
                <div id="entry-history" class="page-content hidden">
					<div id="history-display-area" class="hidden">
						<div id="history-car-header" class="modern-car-header">
						</div>
						
						<div class="history-content-wrapper">
							<table class="history-table">
								<thead>
									<tr>
										<th>Date</th>
										<th>Odometer</th>
										<th>Task / Title</th>
										<th>Description</th>
										<th>Oil</th>
										<th></th>
										<th></th>
										<th></th>
									</tr>
								</thead>
								<tbody id="history-table-body">
								</tbody>
							</table>
						</div>
					</div>
				</div>

				<!-- Share Modal -->
				<div id="share-modal" class="modal-backdrop hidden">
					<div class="modal-content">
						<div class="modal-header">
							<h3>Public Sharable Link</h3>
							<button id="close-share-modal-btn" class="close-btn">&times;</button>
						</div>
						<p>Anyone with this link can view a read-only version of this car's history.</p>
						<input type="text" id="share-link-input" readonly>
						<button id="copy-share-link-btn" class="btn-primary" style="margin-top: 10px;">Copy Link</button>
					</div>
				</div>

                <!-- Manage Cars Page -->
                <div id="manage-cars" class="page-content hidden">
					<div class="page-header">
						<button id="add-car-btn" class="btn-primary">Add New Car</button>
					</div>
					<div id="car-list-container">
					</div>
				</div>

				<!-- Car Modal -->
				<div id="car-modal" class="modal-backdrop hidden">
					<div class="modal-content">
						<div class="modal-header">
							<h3 id="modal-title">Add New Car</h3>
							<button id="close-modal-btn" class="close-btn">&times;</button>
						</div>
						<form id="car-form">
							<input type="hidden" id="car-id">
							
							<div class="form-grid">
								<div class="input-group">
									<label for="car-nickname">Nickname</label>
									<input type="text" id="car-nickname" required>
								</div>
								<div class="input-group">
									<label for="car-year">Year</label>
									<input type="number" id="car-year" required>
								</div>
								<div class="input-group">
									<label for="car-make">Make</label>
									<input type="text" id="car-make" required>
								</div>
								<div class="input-group">
									<label for="car-model">Model</label>
									<input type="text" id="car-model" required>
								</div>
								<div class="input-group full-width">
									<label for="car-variant">Variant</label>
									<input type="text" id="car-variant">
								</div>
								<div class="input-group">
									<label for="car-vin">VIN</label>
									<input type="text" id="car-vin">
								</div>
								<div class="input-group">
									<label for="car-license">License Plate(s)</label>
									<input type="text" id="car-license" placeholder="e.g., AB12345, CD67890">
								</div>
								<div class="input-group">
									<label for="car-distance-unit">Distance Unit</label>
									<select id="car-distance-unit" required>
										<option value="km">Kilometers (km)</option>
										<option value="miles">Miles (mi)</option>
									</select>
								</div>
								<div class="input-group">
									<label for="car-color">Assigned Color</label>
									<input type="color" id="car-color" value="#2563eb">
								</div>
								<div class="input-group">
									<label for="car-photo">Car Photo</label>
									<input type="file" id="car-photo" accept="image/*">
								</div>
							</div>
							
							<div class="form-actions">
								<p id="upload-progress"></p>
								<button type="submit" class="btn-primary" id="save-car-btn">Save Car</button>
							</div>
						</form>
					</div>
				</div>
            </div>
        </main>
    </div>

    <!-- Firebase Scripts -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-storage-compat.js"></script>
    
    <script src="script.js"></script>

</body>
</html>